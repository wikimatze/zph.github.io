

<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Civet</title>
  <meta name="author" content="Zander">
  <link rel="author" href="humans.txt">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  
    
  
  <meta name="description" content=" ">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zph.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Civet" type="application/atom+xml">
  <meta name="og:type" content="website" />
  <meta name="og:site_name" content="Civet" />
  <meta name="og:title" content="Civet" />
  <meta name="og:description" content=" " />
  <meta name="og:url" content="http://zph.github.io/index.html"/>
  <meta name="url" content="http://zph.github.io/index.html">
  
  <meta name="distribution" content="global">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25600795-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="/">Civet</a>
    <ul class="nav">
      <li><a href="/">Home</a></li>
      <li><a href="/archives">Archives</a></li>
      <li><a href="/me">About</a></li>
      <li><a href="/yo-contact-me">Hire Me</a></li>
    </ul>
    <ul class="nav" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      
    </ul>
      
    <form class="navbar-form" action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:zph.github.io" />
        <input class="span2" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
      
    
  </div>
</div>
</nav>
  <div id="front-wrapper">
  <div id="hero">
    <div id="hero-inner" class="container">
      <div class="span10 offset1">
  <h1>
    Civet
  </h1>
  <h2>The Spice of Life</h2>
</div>

    </div>
  </div>
  <section id="sub-hero">
    <div class="container">
      <div class="row">
  <div class="span4">
    <h2>About Me</h2>
<p>Polyglot, Problem Solver, and into improving systemic efficiencies.</p>

  </div>
  <div class="span6">
    
<h2>recent public projects</h2>
<dl id="gh_repos" class="dl-horizontal" data-github-user="ZPH" data-github-repo-count="5" data-github-skip-forks="true">
  <dd class="loading">Status updating&#8230;</dd>
</dl>
<script src="/javascripts/github.js" type="text/javascript"> </script>
<script src="/javascripts/libs/jXHR.js" type="text/javascript"> </script>


  </div>
  <div class="span2">
    <h2>found on</h2>

<a href="https://github.com/ZPH/" rel="tooltip" title="Github"><img class="social_icon" title="Github" alt="github icon" src="/images/glyphicons_381_github.png"></a>







<a href="http://twitter.com/_ZPH" rel="tooltip" title="Twitter"><img class="social_icon" title="Twitter" alt="Twitter icon" src="/images/glyphicons_391_twitter_t.png"></a>







<h2>contact at</h2>
<a href="mailto:zander@civet.ws">zander@civet.ws</a>
<a href="http://twitter.com/_ZPH" rel="tooltip" title="Twitter"><img class="social_icon" title="Twitter" alt="Twitter icon" src="/images/glyphicons_391_twitter_t.png"></a>


  </div>
</div>

    </div>
  </section>
  <div class="container">
    <div class="row" id="post-container">
    
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2014/03/conference-advice-how-to-meet-devs-and-influence-ppl/">Conference Advice: How to Meet Devs and Influence Ppl</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2014-03-11T14:55:29-07:00" pubdate data-updated="true">Mar 11<span>th</span>, 2014</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>Want to know the secret about tech conferences? It&rsquo;s not about the talks.  It&rsquo;s not about the venue.</p>

<p>It&rsquo;s about all the people who are there!</p>

<p>While attending <a href="https://twitter.com/rbonales">@RbOnAles</a>, I was asked by <a href="https://twitter.com/eliserius"> @eliserius </a> about how I knew so many people there.  This article is a summary of that discussion.</p>

<p>First off, go to a couple conferences each year.  It&rsquo;s best if your employer will pay all or part of the way.  But if they won&rsquo;t, it&rsquo;s your responsibility to make it to the conferences.  They&rsquo;re an investment in your career&rsquo;s future.</p>

<p>Now that you&rsquo;re attending 3+ regional tech conferences each year, what steps can you take to make the most of it?  Well, remember that you&rsquo;re attending to meet the other attendees.  By virtue of them also attending the conference, they either work at decent companies or they prioritize conference attendance.</p>

<p>So meet these folks!  It&rsquo;s not hard*. (It&rsquo;s terrifying at first, but push past that &amp; make it happen).  I&rsquo;m an introverted person and know a fair number of Ruby conference attendees, but those first few minutes of awkwardly interacting are just that: uncomfortable.  That&rsquo;s fine, move the conversation into tech stuff.  Chat about Service Oriented Architecture, argue about Dependency Injection, take a stand and say that Ruby isn&rsquo;t a dying language.</p>

<p>Remember, these folks who are at the conference also want to meet people.</p>

<p>What specific steps do I recommend for breaking the ice or stacking your social deck at the conference?</p>

<ul>
<li>Don&rsquo;t attend conferences with workmates.  Or if you&rsquo;re at conference, avoid them.  There are 363 other days to bs with &lsquo;em.  You&rsquo;ve only got 24 hrs * 3 days for the conference&hellip; make the most of it and meet new people.</li>
<li>Set a goal of meeting X new people at conference. Let&rsquo;s consider &ldquo;meeting&rdquo; to be defined as exchanging names and at least one memorable detail about the other party. Maybe they juggle, write assembly, breed horses.  Folks all have a story, ask &ldquo;What brought you to the conference&rdquo;.  Or &ldquo;What tech stuff are you playing with right now?&rdquo;. Or start a heated debate about which <code>$EDITOR</code> to use.  If you&rsquo;re stumped about approaching someone, just be candid, &ldquo;I saw you standing there &amp; realized we hadn&rsquo;t met yet: I&rsquo;m Zander&rdquo;.  Most of the time that&rsquo;s enough to kick off a conversation, though you might choose to use your own name in the prior quotation.</li>
<li>Take your meals with a different new group each time.  With a 2 day conference, that gives you 4 opportunities to meet groups of 4+ people each time.  Some conferences actively organize this kind of activity.  Big shoutout to <a href="http://twitter.com/steelcityruby">@steelcityruby</a> for doing this stuff :).  If your conference isn&rsquo;t doing this, post on twitter that you&rsquo;re organizing a group for Italian/Thai/Indian/Bar food and see who bites.</li>
<li>While out having food with others, buy a meal or drink for some folks you don&rsquo;t know well.  Do it for the nice factor the icing on the cake is that you&rsquo;ll seem even more awesome than you already are.</li>
<li>Bring something to share to the conference and then offer it up to people.  Could be a cardgame, boardgame, bourbon, soda water, LAN party&hellip; just get yourself out there.</li>
<li>Volunteer to carpool from airport to conference.  Or from major city to tiny town where conference exists.</li>
<li>Learn 2 love Twitter.  Start or revive your account.  Twitter is the lifeblood of many Ruby conferences.  Start up Tweetdeck or Tweetbot and add a column dedicated to the conference hashtag.  That way you&rsquo;ll be aware of the pulse of things.</li>
<li>Post Twitter messages with hashtag.  For example at this last conference, I had the pleasure of doing breakfast with my favorite Aussie (<a href="http://twitter.com/ryanbigg">@ryanbigg</a>) by virtue of an early morning Tweet about meeting for breakfast.  It&rsquo;ll also force you to meet people who you might not otherwise get to meet.</li>
<li>Stay at the conference hotel &amp; possibly split a room w/ someone you don&rsquo;t know.  Put a call out among friends to find someone to split room.  It&rsquo;ll be awesome.  At least it has been for me thus far.  Staying at conference hotel itself is wonderful because you&rsquo;ll be in the middle of the action, late night philosophizing on OOP vs. Functional, etc.</li>
<li>Stick around for the evening events each day.  Also stay for the workshops that often take place after the conference ends.  At Ruby On Ales, it was a MiniTest workshop by <a href="http://twitter.com/blowmage">@blowmage</a>.  It was awesome and I got to meet a few more people before leaving.</li>
<li>Still stumped for how to approach people at conference? See if you can recognize anyone at conference from Twitter or Github profiles.  Then go up &amp; thank them for the Open Source work they do.  It&rsquo;ll give them chills :).</li>
<li>Final tip: I&rsquo;m terrified at the beginning of each conversation.  Once I warm up, it&rsquo;s groovy, but until then it&rsquo;s rough.  Get that momentum going, force yourself out of the comfort zone, and see what happens.  Soon enough, those conferences will feel like reunions filled with friends.</li>
</ul>


<p>PS &ndash; I have a new friend from @RbOnAles who&rsquo;s looking for a remote role (or in SF) either as QA or Jr. Ruby Developer. DM me on Twitter if you know of options.</p>
</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2014/02/pathogen-dot-vim-without-the-submodules-use-infect/">Pathogen.vim Without the Submodules: Use Infect</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2014-02-17T14:06:00-08:00" pubdate data-updated="true">Feb 17<span>th</span>, 2014</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>Over the weekend I finally admitted to myself that I hate submodules.</p>

<p>But they&rsquo;re a keystone to one of my primary development tools: Vim.  In order to use Vim, I use the Pathogen.vim plugin by @tpope.  In order to use Pathogen, you normally use submodules in the <code>.vim/bundle/</code> folder.</p>

<p>But submodules are the work of the devil.</p>

<p>I tried out the Vundle plugin and was seeing much longer loadtime for vim:</p>

<script src="https://gist.github.com/zph/db5aa2dc128693ba9583.js"></script>


<p>So I asked around on Twitter and <a href="https://twitter.com/jwieringa"> @jwieringa </a> advised me to checkout <a href="https://github.com/csexton/infect"> &lsquo;infect&rsquo; </a> by <a href="https://twitter.com/crsexton"> @crsexton </a>.</p>

<p>And <code>infect</code> is awesome! It works with Pathogen to give it a declarative style for plugins.  An example is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"=bundle tpope/vim-pathogen
</span><span class='line'>"=bundle tpope/vim-sensible
</span><span class='line'>source ~/.vim/bundle/vim-pathogen/autoload/pathogen.vim
</span><span class='line'>execute pathogen#incubate()
</span><span class='line'>
</span><span class='line'>"=bundle mileszs/ack.vim
</span><span class='line'>"=bundle vim-scripts/AutoTag
</span><span class='line'>"=bundle kien/ctrlp.vim
</span><span class='line'>"=bundle Raimondi/delimitMate
</span><span class='line'>"=bundle sethbc/fuzzyfinder_textmate
</span><span class='line'>"=bundle tpope/gem-ctags
</span><span class='line'>"=bundle gregsexton/gitv
</span><span class='line'>"=bundle sjl/gundo.vim
</span><span class='line'>"=bundle tpope/vim-vinegar
</span><span class='line'>"=bundle jnwhiteh/vim-golang
</span><span class='line'>"=bundle wting/rust.vim
</span><span class='line'>
</span><span class='line'>call pathogen#helptags()
</span><span class='line'>set nocompatible      " We're running Vim, not Vi!
</span><span class='line'>syntax on             " Enable syntax highlighting
</span><span class='line'>filetype on           " Enable filetype detection
</span><span class='line'>filetype indent on    " Enable filetype-specific indenting
</span><span class='line'>filetype plugin on    " Enable filetype-specific plugins</span></code></pre></td></tr></table></div></figure>


<p>Use it. Love it. Don&rsquo;t look back!</p>

<p>If you want faster downloads with &lsquo;infect&rsquo; try this unofficial fork of the standalone: <a href="https://github.com/zph/zph/blob/master/home/bin/infect.">https://github.com/zph/zph/blob/master/home/bin/infect.</a>  When I have time, I&rsquo;ll work w/ @crsexton to get this added to &lsquo;infect&rsquo;.</p>
</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2014/02/solving-issues-with-rvm-on-bsd/">Solving Issues With RVM on BSD</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2014-02-15T03:00:00-08:00" pubdate data-updated="true">Feb 15<span>th</span>, 2014</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>RVM installation went poorly on FreeBSD.</p>

<p>The ca-certificates weren&rsquo;t up to date according to the install script.</p>

<p>Really, the ca-certificates weren&rsquo;t in the right location for RVM&rsquo;s curl install script.</p>

<p>These commands as root fixed it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir -p /usr/local/opt/curl-ca-bundle
</span><span class='line'>ln -s /usr/local/share/certs/ca-root-nss.crt /usr/local/opt/curl-ca-bundle/share/ca-bundle.crt</span></code></pre></td></tr></table></div></figure>

</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2014/02/finding-myself-in-bsd/">Finding Myself in BSD</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2014-02-15T02:01:00-08:00" pubdate data-updated="true">Feb 15<span>th</span>, 2014</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>Blame smartOS not reading my SATA controller.</p>

<p>Blame Linux for not having first class support for ZFS (where my data is held).</p>

<p>Blame <a href="https://twitter.com/canadiancreed"> @canadiancreed </a> for giving me a way out of the quandry.</p>

<p>The backstory is that I moved all of my backups to two ZFS pools a few years ago.  I was running ZFSonLinux and it generally worked&hellip;. except when I rebooted the server and had to force import the pools.</p>

<p>Fast forward to that server being replaced by a workstation (i7 Haswell, 240GB Sata3 SSD, and 24GB RAM).  I tried smartOS by Joyent and ran into issues with my SATA controller not being recognized.  It&rsquo;s a shame given how awesome the smartOS vm administration is.  I mean vmadm and imgadm are light years ahead of Docker.</p>

<p>Since smartOS refused to recognize 3 of my 8 drives I ran back to Linux.  The good new, Linux recognized the sata controller.  The bad news, Linux couldn&rsquo;t import the pools.  Frankly, Linux had a hell of a time with building the ZFS on Linux kernel modules.  I managed to piece together a few clues from the ZFSonLinux Issues on Github.  In fact, thanks to <a href="https://github.com/dajhorn"> @dajhorn </a> for supplying answers on that Github issue which allowed me to build the kernel modules.</p>

<p>This sounds promising doesn&rsquo;t it? It&rsquo;s not, it was a horrorshow.  Linux refused to import the one of the two zpools.  One of them imported nicely, the mission critical financial records.  The other semi-critical zpool was shot and refused to import under Linux.</p>

<p>I spent a whole evening banging my head against this issue. If it hadn&rsquo;t been for <a href="https://twitter.com/canadiancreed"> Chris Reed </a> I wouldn&rsquo;t have hit upon the solution.</p>

<p>His recommendation was to try FreeBSD&hellip; so I did.  And it recognized the SATA controller and also imported the zpools cleanly!  So after a dry run w/ FreeBSD, I installed PC-BSD, which is a desktop variant based on FreeBSD. Think of it as the Ubuntu of the BSD world.  And hell yeah, it&rsquo;s all working :).</p>

<p>So far, I&rsquo;m really liking it.  Replace &lsquo;aptitude&rsquo; with &lsquo;pkg&rsquo; and it&rsquo;s pretty similar.  Except, PC-BSD is working where Linux &amp; ZFS were a hassle.</p>
</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2014/02/using-null-terminators-in-star-nix/">Using Null Terminators in Linux/OSX</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2014-02-13T01:49:00-08:00" pubdate data-updated="true">Feb 13<span>th</span>, 2014</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>I ran into an issue with using <code>xargs</code> with <code>rm -rf</code>.</p>

<p>This could be dicey, so get your safety hats on.</p>

<p>The issue was that the filename included an apostrophe.  So when trying to do a simple command such as <code>tree -fi | grep conflicted | xargs rm -f '{}'</code>, I received an error about having an unterminated quote in the parameter.</p>

<p>Apparently, some versions of xargs allow you to specify a delimiter with a <code>-d</code> but the copy on my Mac didn&rsquo;t have such a flag.</p>

<p>Instead, I learned that <code>egrep --null</code> will use a null character as the divider between matches.  So the following solved my problem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>tree -fi | egrep --null conflicted | xargs -0 rm -f <span class="s1">&#39;{}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s break that command set down:</p>

<ul>
<li><code>tree -fi</code> is a trick I recently learned from my friend @olleolleolle.  It prints out the local tree of files and the -fi prints out the whole filename (including directories).</li>
<li><code>egrep --null conflicted</code> is where the magic starts.  The <code>--null</code> flag tell egrep to separate matches with a null character.</li>
<li><code>xargs -0 rm -f '{}'</code> this tells xargs that the null character is divider and to remove each filename that comes through the linux pipe.</li>
</ul>


<p>This is yet another example of why I&rsquo;m impressed with the commandline.  Simple little tools that can be chained together with symbiotic behavior.</p>
</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2014/02/automating-email-with-ruby/">Automating Email With Ruby</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2014-02-09T20:28:00-08:00" pubdate data-updated="true">Feb 9<span>th</span>, 2014</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>Last Friday was the kind of day where I dropped into a Pry repl in order to bang out an automation script.</p>

<p>The challenge was: automate the retrival of specific emails that contained receipts, wrangle them into sane data structures, and dump them into a spreadsheet with both daily totals and an absolute total.</p>

<p>An example email looked like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> Receipt #9999999999999
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> County:Example, FL      Date: 2014-1-27 
</span><span class='line'>
</span><span class='line'> Name:Jill Doe
</span><span class='line'> Credit Card #XXXXXXXXXXXX9999
</span><span class='line'> Authorization code:999999
</span><span class='line'>
</span><span class='line'> No.of Pages viewed:3
</span><span class='line'> Total Amount: $ 3.00
</span><span class='line'>
</span><span class='line'> Thank you for visiting http://www.example.com  </span></code></pre></td></tr></table></div></figure>


<p>First step was to build an email parser for this format.  I tried to keep it tolerant of future changes to the email generation scheme.</p>

<p>The general steps involved are:
1. Split the body linewise
2. Create a method for each piece of content to extract.
3. From the collection of lines, grep for the line with appropriate unique text.
4. Then in that line, use a regex to find the specific portion of data.</p>

<p>The full code for that module is listed below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Email</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Parser</span>
</span><span class='line'>      <span class="kp">attr_accessor</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:content</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>        <span class="vi">@raw_content</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>        <span class="vi">@content</span> <span class="o">=</span> <span class="vi">@raw_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:strip</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">receipt</span>
</span><span class='line'>        <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/receipt/i</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="sr">/\d+/</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">county_line</span>
</span><span class='line'>        <span class="vi">@county_line</span> <span class="o">||=</span> <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/county.*date/i</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>                                <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/\W{3,}/</span><span class="p">)</span>
</span><span class='line'>                                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="no">Hash</span><span class="o">[*</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:strip</span><span class="p">)</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">county</span>
</span><span class='line'>        <span class="n">county_line</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="s2">&quot;County&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">date</span>
</span><span class='line'>        <span class="n">county_line</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="s2">&quot;Date&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>        <span class="n">array</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/name/i</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">credit_card_number</span>
</span><span class='line'>        <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/credit card/i</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="sr">/#.*$/</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">authorization_code</span>
</span><span class='line'>        <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/authorization code/i</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">pages_viewed</span>
</span><span class='line'>        <span class="k">begin</span>
</span><span class='line'>          <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/pages viewed/i</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="sr">/\d+/</span><span class="o">].</span><span class="n">strip</span>
</span><span class='line'>        <span class="k">rescue</span> <span class="no">NoMethodError</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>          <span class="nb">warn</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2"> for </span><span class="si">#{</span><span class="n">content</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">total_amount</span>
</span><span class='line'>        <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/total amount/i</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>                                     <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>                                     <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>                                     <span class="o">.</span><span class="n">strip</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">website</span>
</span><span class='line'>        <span class="n">content</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/visiting http/i</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="sr">/http.*$/i</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">all</span>
</span><span class='line'>        <span class="no">ParsingPresenter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span class='line'>          <span class="ss">county</span><span class="p">:</span> <span class="n">county</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">date</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span>
</span><span class='line'>          <span class="nb">name</span><span class="p">:</span> <span class="nb">name</span><span class="p">,</span>
</span><span class='line'>          <span class="n">credit_card_number</span><span class="p">:</span> <span class="n">credit_card_number</span><span class="p">,</span>
</span><span class='line'>          <span class="n">authorization_code</span><span class="p">:</span> <span class="n">authorization_code</span><span class="p">,</span>
</span><span class='line'>          <span class="n">pages_viewed</span><span class="p">:</span> <span class="n">pages_viewed</span><span class="p">,</span>
</span><span class='line'>          <span class="n">total_amount</span><span class="p">:</span> <span class="n">total_amount</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">website</span><span class="p">:</span> <span class="n">website</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">receipt</span><span class="p">:</span> <span class="n">receipt</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span class='line'>        <span class="n">ps</span> <span class="o">=</span> <span class="kp">new</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span class='line'>        <span class="n">ps</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">ParsingPresenter</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">OpenStruct</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that in order, I set about using the awesome <code>ruby-gmail</code> gem for retrieving said emails. Note: after completing this project, I learned of a continuation of the <code>ruby-gmail</code> gem called <code>gmail</code>.  All the code in these examples is specific to the older incarnation of the gem.</p>

<p><code>ruby-gmail</code> has a simple interface for retrieving messages between date ranges.  So I setup a specific Gmail filter for emails from a certain sender that included the text &lsquo;receipt&rsquo;.</p>

<p>There&rsquo;s nothing too fancy in this code, but it&rsquo;s important to set <code>@gmail.peek = true</code> so that programatically viewed emails aren&rsquo;t marked &lsquo;read&rsquo;.  Also of note is the use of Dotenv for setting secret values without risking them in a git repo.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">class</span> <span class="nc">Retriever</span>
</span><span class='line'>
</span><span class='line'>      <span class="no">USER</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;GMAIL_USER&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="no">PASSWORD</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;GMAIL_PASSWORD&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="no">LABEL</span> <span class="o">=</span> <span class="s1">&#39;Receipts&#39;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kp">attr_accessor</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:gmail</span><span class="p">,</span> <span class="ss">:messages</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="no">USER</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="no">PASSWORD</span><span class="p">)</span>
</span><span class='line'>        <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>        <span class="vi">@password</span> <span class="o">=</span> <span class="n">password</span>
</span><span class='line'>        <span class="vi">@gmail</span> <span class="o">=</span> <span class="no">Gmail</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@user</span><span class="p">,</span> <span class="vi">@password</span><span class="p">)</span>
</span><span class='line'>        <span class="vi">@gmail</span><span class="o">.</span><span class="n">peek</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">message_count_in_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</span><span class='line'>        <span class="c1">#dates as &#39;2010-02-10&#39;</span>
</span><span class='line'>        <span class="n">gmail</span><span class="o">.</span><span class="n">inbox</span>
</span><span class='line'>             <span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="ss">:after</span> <span class="o">=&gt;</span> <span class="n">start_date</span><span class="p">,</span> <span class="ss">:before</span> <span class="o">=&gt;</span> <span class="n">end_date</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">emails_in_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="no">LABEL</span><span class="p">)</span>
</span><span class='line'>        <span class="c1">#dates as &#39;2010-02-10&#39;</span>
</span><span class='line'>        <span class="n">gmail</span><span class="o">.</span><span class="n">mailbox</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span class='line'>             <span class="o">.</span><span class="n">emails</span><span class="p">(</span><span class="ss">:after</span> <span class="o">=&gt;</span> <span class="n">start_date</span><span class="p">,</span> <span class="ss">:before</span> <span class="o">=&gt;</span> <span class="n">end_date</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">message_presenters_in_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</span><span class='line'>        <span class="n">msgs</span> <span class="o">=</span> <span class="n">emails_in_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</span><span class='line'>        <span class="vi">@messages</span> <span class="o">=</span> <span class="n">msgs</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span>
</span><span class='line'>          <span class="no">Presenter</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Presenter</span>
</span><span class='line'>      <span class="kp">attr_accessor</span> <span class="ss">:email</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span class='line'>        <span class="vi">@email</span> <span class="o">=</span> <span class="n">msg</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">body</span>
</span><span class='line'>        <span class="n">email</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">date</span>
</span><span class='line'>        <span class="n">email</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">to_date</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">date_string</span>
</span><span class='line'>        <span class="n">date</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span class='line'>        <span class="n">presenter</span> <span class="o">=</span> <span class="kp">new</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span class='line'>        <span class="no">Message</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">date</span><span class="p">:</span> <span class="n">presenter</span><span class="o">.</span><span class="n">date_string</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="n">presenter</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">Message</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">OpenStruct</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The last task in building this tool was dumping the data to a CSV with totals by date as well as a grand total. The process is simple, pass in a collection of messages and iterate through them by date, add a subtotal per date, then add a final row with grand total.</p>

<p>I like to break out rows into their own methods when possible.  In fact, were I to rewrite this code, the message row would have its own method to clean up the inner loop of <code>messages_by_date()</code>.  Another trick that helped for testing was to not generate a file on the filesystem.  <code>CSV</code> takes either an <code>open</code> or a <code>generate</code> method.  With <code>generate</code> it will pass the complete csv file out as the return value!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CSVBuilder</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:messages</span><span class="p">,</span> <span class="ss">:csv</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@messages</span> <span class="o">=</span> <span class="n">messages</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>      <span class="vi">@csv</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">generate</span> <span class="k">do</span> <span class="o">|</span><span class="n">csv</span><span class="o">|</span>
</span><span class='line'>        <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="n">header</span>
</span><span class='line'>        <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="n">empty_row</span>
</span><span class='line'>        <span class="n">uniq_dates</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">date</span><span class="o">|</span>
</span><span class='line'>          <span class="n">messages_by_date</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span>
</span><span class='line'>            <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">msg</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">receipt</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">authorization_code</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">pages_viewed</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">credit_card_number</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">total_amount</span><span class="o">]</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>          <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="n">sum_totals_row</span><span class="p">(</span><span class="n">messages_by_date</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="s2">&quot;Subtotal for </span><span class="si">#{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="n">empty_row</span>
</span><span class='line'>        <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="n">sum_totals_row</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="s2">&quot;Total Amount&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">header</span>
</span><span class='line'>      <span class="o">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s1">&#39;Receipt #&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s1">&#39;Authorization Code&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s1">&#39;Pages Viewed&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s1">&#39;Name&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s1">&#39;Credit Card #&#39;</span><span class="p">,</span>
</span><span class='line'>       <span class="s1">&#39;Total Amount&#39;</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">empty_row</span>
</span><span class='line'>      <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">messages_by_date</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span class='line'>      <span class="n">messages</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="n">m</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">date</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">uniq_dates</span>
</span><span class='line'>      <span class="n">messages</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:date</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">sort</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">sum_totals_row</span><span class="p">(</span><span class="n">msgs</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span class='line'>      <span class="n">rawsum</span> <span class="o">=</span> <span class="n">msgs</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="n">m</span><span class="o">.</span><span class="n">total_amount</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="ss">:+</span><span class="p">)</span>
</span><span class='line'>      <span class="n">sum</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span> <span class="s2">&quot;%.2f&quot;</span><span class="p">,</span> <span class="n">rawsum</span> <span class="p">)</span>
</span><span class='line'>      <span class="n">sum_row_padding</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span class='line'>      <span class="n">sum_row</span> <span class="o">=</span> <span class="o">[</span> <span class="n">sum_row_padding</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">sum</span> <span class="o">].</span><span class="n">flatten</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m also quite proud of the variable name <code>rawsum</code> because it&rsquo;s rawsome to design code that will save a couple hours every two weeks.</p>

<p>With a good ecosystem of libraries, it&rsquo;s only a couple hours of work to write a re-usable tool that saves significant amounts of time. Hooray :).</p>
</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2013/06/adventures-with-mri-2-dot-0-0-and-zlib-a-story-of-malformed-gzips/">Adventures With MRI 2.0.0 and Zlib: A Story of Malformed Gzips</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2013-06-20T00:42:00-07:00" pubdate data-updated="true">Jun 20<span>th</span>, 2013</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>It started off as a casual inquiry on Twitter:</p>

<blockquote class="twitter-tweet"><p><a href="https://twitter.com/geopet">@geopet</a> Sounds strange that 193 would work for external API and not 2.0.. can you share what youre working on? Or TDD test via webmock?</p>&mdash; Zander (@_ZPH) <a href="https://twitter.com/_ZPH/statuses/345536278604963841">June 14, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>And led to my friend @geopet posting the Minimum Viable Demo as a Gist:</p>

<blockquote class="twitter-tweet"><p><a href="https://twitter.com/Strabd">@Strabd</a> <a href="https://twitter.com/_ZPH">@_ZPH</a> But heres the gist with the code and the results: <a href="https://t.co/ajiAh8lQTN">https://t.co/ajiAh8lQTN</a></p>&mdash; Geoff Petrie (@geopet) <a href="https://twitter.com/geopet/statuses/345567430841597952">June 14, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<h2>And it was interesting</h2>

<p>What we found out was that the Ruby open-uri library would make calls to an external API (Wunderground) and throw a Zlib::DataError when run in MRI Ruby 2.0.0.  The strange thing was that MRI 1.9.3 works perfectly fine.  Same exact story when the GET Request comes from Net/HTTP instead of open-uri.  But it succeeds on 2.0.0 when using the RestClient Gem, as documented by @injekt.</p>

<h2>The Gloves Come Off</h2>

<p>We dove into the source of the error and determined that it was thrown from <code>net/http/response.rb:357</code>.  In order to better understand the error, I sequentially placed <code>binding.pry</code> statements to determine where the error percolated to the surface.  It was the call to <code>@inflate.finish</code> which was where the Zlib::DataError surfaced.</p>

<p>I left the code at this point and posted my initial findings back to Geoff and left the project alone.</p>

<h2>Today</h2>

<p>Then I saw this message and it was time for more digging :).</p>

<blockquote class="twitter-tweet"><p>Big thanks to <a href="https://twitter.com/_ZPH">@_ZPH</a> &amp; <a href="https://twitter.com/lee_jarvis">@lee_jarvis</a> for helping out with my 1.9.3/2.0 question. The discussion has led to more questions, but its a start!</p>&mdash; Geoff Petrie (@geopet) <a href="https://twitter.com/geopet/statuses/347460923130269696">June 19, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>I started by forking his Gist and pulling it down to my local computer. My first phase of troubleshooting was to try alternate tools, in order to see how they dump the HTTP response.  Good ol&#8217; <code>curl</code> came to the rescue and provided me with the results that I placed in <a href="https://github.com/zph/mri_2_0_0_zlib_troubleshooting/blob/master/curl_response.txt">curl_response.txt</a> and <a href="https://github.com/zph/mri_2_0_0_zlib_troubleshooting/blob/master/curl_raw.txt">curl_raw.txt</a>.  Notice the rather interesting artifact around line 12 on the RAW version that isn&rsquo;t present in the alternate curl response.</p>

<h2>Pulling in Net/HTTP</h2>

<p>It felt like progress and I wanted a better way to tweak the net/http library.  I prepended the local directory to Ruby&rsquo;s LOAD_PATH and copies the net folder out from MRI&rsquo;s lib directory.  Having the <code>Dir.pwd</code> prepended to the path enabled me to make very convenient testing tweaks to the Ruby Standard Library without needing to alter my standard RVM install :).</p>

<h2>Tapping the Sockets</h2>

<p>With net/http libs loaded from the local file, I was off to the races. I tapped into the internal workings by using the &lsquo;sack&rsquo; utility <a href="https://github.com/zph/sack">sack</a> for jumping directly into and editing <code>ack</code> results.  With the addition of a strategically placed <code>binding.pry</code>, I was able to tap into the live socket info via a <code>socket.read_all</code> and write that out as a binary dump to <code>socket_content.bin</code>.</p>

<h2>Reducing it to Elements</h2>

<p>The last step in my troubleshooting was to create <code>zlib_targeted.rb</code> for isolating the zlib load issues from net/http.  Since the underlying issue appears to be a malformed gzip returned from Wunderground&rsquo;s API, I created zlib_targeted.rb to remove net/http from the equation.  Check out the demo content of the file below:</p>

<script src="https://gist.github.com/a7bfc0acbc0876363ede.js"></script>


<h2>Conclusion</h2>

<p>Now we have a very narrowly tailored set of examples that dig into the exact errors, thanks to @geopet, myself, and @injekt.</p>

<p>For more info, see the comments in this Gist repo from @geopet:
<a href="https://gist.github.com/geopet/5782836">Initial Gist</a></p>

<p>Or my repo that includes the files described in this post:
<a href="https://github.com/zph/mri_2_0_0_zlib_troubleshooting">Full repo</a></p>

<p>I&rsquo;m happy with how the toubleshooting has progressed and would like to see this issue resolved, whether it is a malformed response from Wunderground, intolerant behavior from MRI 2.0.0, or anything else.</p>
</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2013/06/dont-fear-pair-programming-a-guide-to-starting/">Don&#8217;t Fear Pair Programming - a Guide to Starting</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2013-06-02T00:00:00-07:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2013</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>Pair Programming is becoming a big deal in the Ruby programming world: this guide will help you get started.</p>




<h2>Pre-Reqs:</h2>




<p>General familiarity with Ruby tools (Bundler, Gems, RVM/Rbenv)
Basic commandline comfort</p>




<h2>What is Pairing?</h2>




<p>In its simplest form, pair programming is where a pair of programmers work on a problem using the same computer.</p>




<p>Since I live don&#8217;t live in a technology hub in America, programming in the same physical location is challenging.  Instead, it&#8217;s possible to replicate that experience with both parties in separate locations.</p>




<h2>How Does it Work?</h2>




<p>Setup a video call using Skype, Google Plus, Twelephone.
Both partners connect into a shared machine such as a Virtual Private Server (VPS).
Each partner connects into a shared Tmux session.
Both of the individuals can jointly edit the same files, as if they were present at the same keyboard.</p>




<h2>Setting It Up From Scratch</h2>




<p>Signup with a VPS provider (I&#8217;m currently very happy with <a href="www.digitalocean.com">DigitalOcean</a>)
Boot up a basic 512MB RAM instance in the Linux flavor of your choice. I&#8217;ll use Ubuntu 12.04 x32 for this example.
Once the instance is booted up, let&#8217;s connect and setup basic sane defaults.
Install tmux and vim-nox using the package manager.
Install Ruby using RVM, Rbenv, or Chruby.
Install Tweemux Gem - <code>gem install tweemux</code>
Now that we&#8217;ve laid the groundwork for it, let&#8217;s work on making it available for a partner.</p>




<h2>Inviting a Pair</h2>




<p>When ready to invite a pairing partner, we start by adding a unique user for them.  For convenience, it&#8217;s best to add their username from Github.</p>




<p><code>adduser --disabled-password $PAIRNAME</code></p>




<p>Next we&#8217;ll use the Tweemux Gem from RKing to pull down the partner&#8217;s public key from Github, and add it to their <code>~/.ssh/authorized_keys</code>.</p>




<p><code>tweemux hubkey $PAIRNAME</code></p>




<p>At this point in the process, that user can login to your server using the IP address, their Github username, and their matching private key.</p>




<p>ie - <code>ssh $PAIRNAME@IP_ADDRESS_OF_SERVER</code></p>




<p>At this point, the host should fire up a shared Tmux session:</p>




<p><code>tmux -S /tmp/pair</code></p>




<p>And enable that socket to be world readable:</p>




<p><code>chmod 777 /tmp/pair</code></p>




<p>NOTE: Doing this on anything other than a bare server, or with someone you don&#8217;t trust, isn&#8217;t a secure or a good idea.  Don&#8217;t do this on a production server or with sketchy folks!</p>




<p>Next, it&#8217;s time for the guest to join the shared Tmux session:</p>




<p><code>tmux -S /tmp/pair attach</code></p>




<p>And you&#8217;re both in the same Tmux session!  The view, keyboard and such is all shared =).</p>

</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2013/05/starting-with-vim/">Starting With Vim</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2013-05-26T00:00:00-07:00" pubdate data-updated="true">May 26<span>th</span>, 2013</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content">[caption id=&#8221;attachment_712&#8221; align=&#8221;alignleft&#8221; width=&#8221;500&#8221;]<a href="http://www.civet.ws/wp-content/uploads/2013/05/8355974382_6063b7935d.jpg"><img src="http://www.civet.ws/wp-content/uploads/2013/05/8355974382_6063b7935d.jpg" alt="" width="500" height="313" class="size-full wp-image-712" /></a> By: <a href='http://www.flickr.com/photos/protocol7/8355974382/' target='_blank'>Niklas Gustavsson</a>[/caption]<p>It&#8217;s been two lovely years with Vim and I&#8217;m <strong>sold</strong>!  Vim&#8217;s the straight edge razor that slices through code.  It&#8217;s like having a finely crafted and personalized lightsaber.</p>

<p>This post is aimed at getting a new Vim user up to speed without cutting off or wanting to sever their hands.</p>

<h2>Getting Started</h2>

<ul>
<li>Use GVim or MacVim (avoid Terminal Vim until more proficient, then generally avoid GUI Vims)</li>
<li>Learn the Vim Modes</li>
<li>Learn survival tactics ala <a href="http://yannesposito.com/Scratch/en/blog/Learn-Vim-Progressively/">Progressive Vim</a></li>
<li>Learn to serenade this wild beast called Vim in its own language</li>
<li>Add plugins</li>
</ul>

<p>I&#8217;ll assume that readers of my blog can install GVim or MacVim on their own.  On OSX it&#8217;s as simple as using homebrew.  On Linux, use the awesome package manager of your choice.</p>

<h2>Vim Modes</h2>

<p>Vim is a modal editor.  You have three essential modes of operating:</p>

<ul>
<li>Insert Mode (used for typing)</li>
<li>Visual Mode (used for selecting)</li>
<li>Command Mode (used for executing commands/movements)</li>
</ul>

<p>Having three modes means that the keyboard can have 3x the number of functions because each key can have an alternate meaning in the various modes.  For example, take the letter &#8216;i&#8217;:</p>

<ul>
<li>In command mode, i places the user in insert mode</li>
<li>In insert mode, i types the letter i</li>
<li>in visual mode, it appears not to do anything (I could be wrong, but 10 secs of testing back me up)</li>
</ul>

<p>The first thing to learn is a lesson from Douglas Adams: &#8220;Don&#8217;t Panic!&#8221;.</p>

<p>When lost in Vim or things are going wrong, mash ESC until you&#8217;re back in Command Mode.</p>

<p>When a file gets messed up because you&#8217;re unfamiliar with Vim, type ESC followed by :q! This will quit the file without saving changes (forced quit).  If the changes are important, enter command mode with ESC and type :wq to write the changes to disk.</p>

<p>When you&#8217;re ready to type into the text file, type i to enter insert mode.  At this point, typing will proceed as normal until you hit escape to leave insert mode.</p>

<h2>Pat yourself on the back</h2>

<p>You&#8217;re now as accomplished as I was for my first year of dabbling with Vim!</p>

<p>I didn&#8217;t realize how little of Vim I knew until I saw the surgeon&#8217;s precision with which Gary Bernhardt wielded Vim.  As soon as I saw this I wanted more.</p>

<p>I took his advice and started paying attention to the language of Vim, which largely consists of unmodified alphabet keys and shifted alphabet keys.  Learning some of these has made my typing DRASTICALLY more efficient.  I now feel very little resistance when typing.  It&#8217;s as if my thoughts are able to leap onto the screen without obstacles.  It&#8217;s magic folks!  And you too can cast these spells with enough time and effort.</p>

<p>But mastering Vim (or at least becoming proficient) is a longer topic than I can cover in this post.  So let&#8217;s move on to discuss plugins and the .vimrc.</p>

<h2>Vimrc</h2>

<p>Let&#8217;s get this out of the way: Vim&#8217;s not terribly friendly with the default configuration!</p>

<p>So what&#8217;s the solution? .vimrc and Vim plugins.</p>

<p>The .vimrc file goes in your home directory, ie ~/.vimrc, and dictates Vim&#8217;s configuration.  You can tweak the colorscheme, the timeoutlen, and just about anything from here.  Here&#8217;s an example of what&#8217;s in my own .vimrc:</p>

<script src="https://gist.github.com/db3c4ad77f7a9d27fcaa.js"></script>

<p>Plugins are re-usable Vim code that has grown too large to be included in the Vimrc.  Plugins extend the functionality of Vim and can make it act more like an IDE.  There&#8217;s currently a vibrant community of Vim users and a growing number of Vim plugins.</p>

<p>Here&#8217;s a list of My Current Plugins <a href="https://github.com/zph/zph/tree/master/home/.vim/bundle">repo</a>:</p>

<p>And here are the ones that I use daily:</p>

<p>[cc_bash]
ack.vim
ctrlp.vim
delimitMate
gundo
slimux
supertab
sweet-rspec-vim
vim-bundler
vim-commentary
vim-detailed
vim-dispatch
vim-endwise
vim-eunuch
vim-fugitive
vim-git
vim-numbertoggle
vim-powerline
vim-rails
vim-repeat
vim-rspec
vim-ruby
vim-ruby-refactoring
vim-surround
[/cc_bash]</p>

<p>Hope this helps get someone started in Vim.  It&#8217;s a very rewarding and sometimes frustrating journey.</p>

<p>I&#8217;d love to help my readers learn Vim! Let me know about your stumbling blocks and difficulties in the comments or on Twitter <a href="http://twitter.com/_ZPH">@_ZPH</a></p>
</div>
  
  


</div>

      </article>
    
    
      <article class="span4">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title"><a href="/2013/05/buff-a-gem-that-puts-muscle-in-the-buffer-api/">Buff - a Gem That Puts Muscle in the Buffer API</a></h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Zander</span></span>
  

 - 
        








  


<time datetime="2013-05-26T00:00:00-07:00" pubdate data-updated="true">May 26<span>th</span>, 2013</time> - 
        


        
      </p>
    
  </header>


  <div class="entry-content"><p>It&#8217;s Done!  <a href="http://github.com/zph/buff">Buff</a> is a Ruby Gem that wraps the <a href="http://bufferapp.com">Buffer</a> API.</p>

<h2>Why Write Buff Gem from Scratch?</h2>

<p>Because the current Buffer Gem doesn&#8217;t have full coverage for the API.  I started to update the Buffer Gem but quickly realized that I was spinning my wheels.  I wanted to implement the gem as a set of layered abstractions and to be able to process the responses using Hashie::Mash.  I envisioned a Gem where each response was a first class Ruby object, where each nested key could be called as a method.</p>

<p>I realized that it would be cleaner and more expedient to code from scratch: I spent the next few hours and produced a gem that had feature parity with Buffer&#8217;s existing gem:</p>

<p>Introducing <a href="http://github.com/zph/buff">Buff</a>, the API complete Ruby Wrapper for <a href="http://bufferapp.com"> BufferApp.com. </a> Buff muscles Ruby into Buffer&#8217;s API.</p>

<h4>Buff is RSpec tested, Webmocked, Travis CI&#8217;d, and easy to use.</h4>

<script src="https://gist.github.com/zph/5654310.js"></script>

<h2>Setbacks and Triumphs</h2>

<p>It wasn&#8217;t all roses and perfume in the creation of this gem.   Three setbacks stand out in my mind.</p>

<h3>Webmock</h3>

<p>I&#8217;ve previously used VCR for testing web APIs, but wanted to use a new system to build new skills.  Webmocks are very pleasant to use and allowed the Specs to verify what API was contacted, along with testing the body content and return values.</p>

<h3>HTTP Libraries</h3>

<p>Buff Gem started with <strong>HTTParty</strong>, which was splendid while implementing the [cci]HTTP GET API[/cci] methods.  Once I began implementing the [cci]HTTP POST[/cci] requests I started experiencing discomfort with using <strong>HTTParty</strong>.  It&#8217;s a reliable library but I didn&#8217;t gel with the DSL for describing HTTP requests.  Thankfully the <strong>HTTParty</strong> calls were wrapped inside the [cci]post[/cci] and [cci]get[/cci] methods in [cci]Buff::Client::Core[/cci].</p>

<p>Since the code was tested with Rspec and the post and get methods were abstracted, swapping out <strong>HTTParty</strong> for <strong>Faraday</strong> was merely a one hour setback.</p>

<p>What a wonderful confirmation that it&#8217;s valuable to wrap external library calls in an abstraction method inside your own library.  This made dependency swaps much simpler.</p>

<h3>Creating correct &#8220;application/x-www-form-urlencoded&#8221; Data</h3>

<p>I expected to find a Standard Library tool for converting a nested Hash + Array object into www-form-encoded data.  I was sorely disappointed, looking at you Addressable Gem, and spent hours trying to find an already coded solution.</p>

<p>After stepping back from the code for two days, I was explaining the problem to non-technical coworkers.  In that moment, my subconscious presented the answer.  I realized how easily I could write the transformation myself.  I mentally coded it on the way home that afternoon and wrote it in bytes that evening.  Here&#8217;s the implementation from [cci]Buff::Client::Encode[/cci]:</p>

<script src="https://gist.github.com/94a89ea5abcfa6f60ee1.js"></script>

<p><strong>Moral of the story</strong>: When stumped, back off and solve another problem.  The subconscious is a useful ally.  Hours of struggling could have been saved through patience and getting other things done.</p>

<h2>What&#8217;s Next?</h2>

<p>Since the Buff Gem provides greater coverage of the Buffer API than the existing Gem, it&#8217;d be awesome to see it replace Buffer Gem as the official Ruby Wrapper.</p>

<p>I feel great about completing a Gem with 100% coverage of an HTTP API :).</p>

<p>I&#8217;m considering writing a couple of small Buffer CommandLine tools for easy posting.  If I have more steam, I&#8217;ll add an Alfred Workflow on top that allows posting to Buffer!</p>

<h2>Want a Demo of Using Buff inside Pry?</h2>
<iframe src="http://showterm.io/1b512291be06a620e4bc6#fast" width="640" height="480"></iframe>
<h2>PS</h2>

<p>If you work with <a href="http://bufferapp.com"> Bufferapp </a> and want to adopt this Gem as your Official Ruby Wrapper, that would be snazzy.  Let&#8217;s talk: <a href="http://twitter.com/_ZPH">@_ZPH</a> or <a href="mailto:zander@civet.ws">Zander</a>!</p>
</div>
  
  


</div>

      </article>
    
    </div>
      <div class="row">
        <ul class="pager">
          
            <li class="previous">
              <a href="/page/2/">&larr; Older</a>
            </li>
          
          
        </ul>
      </div>
  </div>
</div>


  <div id="footer-widgets">
  <div class="container">
    <div class="row">
  <div class="span3">
    <h2>recent posts</h2>
    <ul class="recent_posts">
      
        <li>
          <a href="/2014/03/conference-advice-how-to-meet-devs-and-influence-ppl/">Conference Advice: How to Meet Devs and Influence Ppl</a>
        </li>
      
        <li>
          <a href="/2014/02/pathogen-dot-vim-without-the-submodules-use-infect/">Pathogen.vim without the Submodules: Use Infect</a>
        </li>
      
        <li>
          <a href="/2014/02/solving-issues-with-rvm-on-bsd/">Solving Issues with RVM on BSD</a>
        </li>
      
        <li>
          <a href="/2014/02/finding-myself-in-bsd/">Finding myself in BSD</a>
        </li>
      
        <li>
          <a href="/2014/02/using-null-terminators-in-star-nix/">Using Null Terminators in Linux/OSX</a>
        </li>
      
    </ul>
    <h2><a href="/archives">archives</a></h2>
  </div>
  <div class="span3">
    

  </div>
  <div class="span4">
    
<h2>twitter</h2>
<a href="https://twitter.com/_ZPH" class="twitter-follow-button" data-show-count="true" data-lang="en">Follow @_ZPH</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="tweet" data-twitter-user="_ZPH">
</div>


  </div>
  <div class="span2">
    <h2>found on</h2>

<a href="https://github.com/ZPH/" rel="tooltip" title="Github"><img class="social_icon" title="Github" alt="github icon" src="/images/glyphicons_381_github.png"></a>







<a href="http://twitter.com/_ZPH" rel="tooltip" title="Twitter"><img class="social_icon" title="Twitter" alt="Twitter icon" src="/images/glyphicons_391_twitter_t.png"></a>







<h2>contact at</h2>
<a href="mailto:zander@civet.ws">zander@civet.ws</a>
<a href="http://twitter.com/_ZPH" rel="tooltip" title="Twitter"><img class="social_icon" title="Twitter" alt="Twitter icon" src="/images/glyphicons_391_twitter_t.png"></a>


  </div>
</div>

  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-left">
  <a href="/">Civet</a>
  - Copyright &copy; 2014 - Zander
</p>
<p class="pull-right">
  <span>Powered by <a href="http://octopress.org/">Octopress</a>.</span>
  
    <span>Designed by <a href="http://www.AdrianArtiles.com">Adrian Artiles</a>.</span>
  
</p>

  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="/javascripts/libs/jquery-1.7.2.min.js" type="text/javascript"><\/script>')</script>
<script src="/javascripts/libs/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.tweet.js" type="text/javascript"></script>
<script src="/javascripts/jquery.instagram.js" type="text/javascript"></script>
<script src="/javascripts/libs/jquery.masonry.min.js" type="text/javascript"></script>
<script src="/javascripts/custom.js" type="text/javascript"></script>
<a title="Web Statistics" href="http://clicky.com/100580798"><img alt="Web Statistics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100580798); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100580798ns.gif" /></p></noscript>








  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
